var At=Object.defineProperty,Dt=Object.defineProperties;var Lt=Object.getOwnPropertyDescriptors;var Qe=Object.getOwnPropertySymbols;var Ot=Object.prototype.hasOwnProperty,Et=Object.prototype.propertyIsEnumerable;var Ye=(n,o,t)=>o in n?At(n,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[o]=t,D=(n,o)=>{for(var t in o||(o={}))Ot.call(o,t)&&Ye(n,t,o[t]);if(Qe)for(var t of Qe(o))Et.call(o,t)&&Ye(n,t,o[t]);return n},fe=(n,o)=>Dt(n,Lt(o));var ae=(n,o,t)=>new Promise((s,a)=>{var u=i=>{try{d(t.next(i))}catch(l){a(l)}},h=i=>{try{d(t.throw(i))}catch(l){a(l)}},d=i=>i.done?s(i.value):Promise.resolve(i.value).then(u,h);d((t=t.apply(n,o)).next())});import{d as se,Z as j,_ as ge,N as de,E as ie,a0 as X,l as L,u as e,c as $,f as W,w as be,H as pe,m as qe,r as Ue,h as ke,o as Kt,x as me,J as ut,a7 as Bt,a8 as J,a9 as H,$ as le,a1 as Ce,F as et,aa as Ve,ab as ee,ag as Nt,e as zt,ad as tt,ai as De,aj as Le,ac as nt,n as Mt,z as jt}from"./vue-ea98dac5.js";import{_ as Wt}from"./BasicForm.vue_vue_type_script_setup_true_lang-57ffd037.js";import"./BasicForm.vue_vue_type_style_index_0_lang-c9b7c50c.js";import{P as Ge,b as Vt,D as qt,I as Ke,A as Be,R as oe,F as Ut,u as Re,d as Gt}from"./componentMap-60b4a45b.js";import{u as Xt}from"./useForm-3492eae0.js";import{ap as Zt,aq as Jt,ar as at,h as Ie,i as ye,R as Ee,c as he,a2 as Qt,n as Z,q as Ne,r as Yt,as as en,at as tn,L as nn,Q as an,o as Xe,au as on,u as ln,x as sn,U as ot,ab as cn,I as lt,av as ft,aw as rn,ac as un,z as We,M as fn,P as dn,a5 as hn}from"./index.js";import{aj as gn,ak as mn,al as pn,ai as Cn,z as xe,am as bn,T as we,E as dt,an as Sn,D as vn,d as Oe,ao as wn,ap as yn,ae as _n,ad as Tn,aq as xn}from"./antd-c2e94c83.js";import{a as kn,b as Rn,c as In}from"./TableImg.vue_vue_type_style_index_0_lang-f53fcf63.js";import{i as Y}from"./isBoolean-9388e2d6.js";import{b as st}from"./uuid-31b8b5a4.js";import{g as it}from"./get-3d19de2f.js";import{u as Fn}from"./index-4b210e61.js";import{u as Hn}from"./useWindowSizeFn-844b46eb.js";import{o as Pn}from"./onMountedOrActivated-3eb95ecd.js";import $n from"./sortable.esm-4ae27e0b.js";var An=Zt(function(n,o,t){Jt(n,o,t)});const Dn=An,Ln={class:"edit-header-cell"},ct=se({name:"EditTableHeaderIcon",__name:"EditTableHeaderIcon",props:{title:{type:String,default:""}},setup(n){return(o,t)=>(j(),ge("span",Ln,[de(o.$slots,"default"),ie(" "+X(n.title)+" ",1),L(e(gn))]))}}),On=se({name:"TableHeaderCell",components:{EditTableHeaderCell:ct,BasicHelp:at},props:{column:{type:Object,default:()=>({})}},setup(n){const{prefixCls:o}=Ie("basic-table-header-cell"),t=$(()=>{var u;return!!((u=n.column)!=null&&u.edit)}),s=$(()=>{var h;const u=n.column;return typeof u.customHeaderRender=="function"?u.customHeaderRender(u):(u==null?void 0:u.customTitle)||((h=n.column)==null?void 0:h.title)}),a=$(()=>{var u;return(u=n.column)==null?void 0:u.helpMessage});return()=>L("div",null,[t.value?L(ct,null,{default:()=>[s.value]}):L("span",{class:"default-header-cell"},[s.value]),a.value&&L(at,{text:a.value,class:`${o}__help`},null)])}});function En({page:n,type:o,originalElement:t}){return o==="prev"?n===0?null:L(mn,null,null):o==="next"?n===1?null:L(pn,null,null):t}function Kn(n){const{t:o}=ye(),t=W({}),s=W(!0);be(()=>e(n).pagination,l=>{!Y(l)&&l&&(t.value=D(D({},e(t)),l!=null?l:{}))});const a=$(()=>{const{pagination:l}=e(n);return!e(s)||Y(l)&&!l?!1:D(D({current:1,size:"small",defaultPageSize:Ge,showTotal:_=>o("component.table.total",{total:_}),showSizeChanger:!0,pageSizeOptions:Vt,itemRender:En,showQuickJumper:!0},Y(l)?{}:l),e(t))});function u(l){const _=e(a);t.value=D(D({},Y(_)?{}:_),l)}function h(){return e(a)}function d(){return e(s)}function i(l){return ae(this,null,function*(){s.value=l})}return{getPagination:h,getPaginationInfo:a,setShowPagination:i,getShowPagination:d,setPagination:u}}function Bn(n){return({text:o,record:t,index:s})=>(pe(t).onValid=()=>ae(this,null,function*(){if(Ee(t==null?void 0:t.validCbs)){const a=((t==null?void 0:t.validCbs)||[]).map(h=>h());return(yield Promise.all(a)).every(h=>!!h)}else return!1}),pe(t).onEdit=(a,u=!1)=>ae(this,null,function*(){var h,d;return u||(t.editable=a),!a&&u?(yield t.onValid())&&(yield(h=t.onSubmitEdit)==null?void 0:h.call(t))?(t.editable=!1,!0):!1:(!a&&!u&&((d=t.onCancelEdit)==null||d.call(t)),!0)}),qe(kn,{value:o,record:t,column:n,index:s}))}function ht(n,o){const{key:t,dataIndex:s,children:a}=n;n.align=n.align||qt,o&&(t||(n.key=typeof s=="object"?s.join("-"):s),Y(n.ellipsis)||Object.assign(n,{ellipsis:o})),a&&a.length&&gt(a,!!o)}function gt(n,o){n&&n.forEach(t=>{const{children:s}=t;ht(t,o),gt(s,o)})}function Nn(n,o,t){const{t:s}=ye(),{showIndexColumn:a,indexColumnProps:u,isTreeTable:h}=e(n);let d=!1;if(e(h)||(t.forEach(()=>{const l=t.findIndex(_=>_.flag===Ke);a?d=l===-1:!a&&l!==-1&&t.splice(l,1)}),!d))return;const i=t.some(l=>l.fixed==="left");t.unshift(D(D({flag:Ke,width:60,title:s("component.table.index"),align:"center",customRender:({index:l})=>{const _=e(o);if(Y(_))return`${l+1}`;const{current:v=1,pageSize:E=Ge}=_;return((v<1?1:v)-1)*E+l+1}},i?{fixed:"left"}:{}),u))}function zn(n,o){const{actionColumn:t}=e(n);if(!t)return;const s=o.findIndex(a=>a.flag===Be);s===-1&&o.push(fe(D(fe(D({},o[s]),{fixed:"right"}),t),{flag:Be}))}function Mn(n,o){const t=W(e(n).columns);let s=e(n).columns;const a=$(()=>{const f=he(e(t));if(Nn(n,o,f),zn(n,f),!f)return[];const{ellipsis:c}=e(n);return f.forEach(b=>{const{customRender:w,slots:y}=b;ht(b,Reflect.has(b,"ellipsis")?!!b.ellipsis:!!c&&!w&&!y)}),f});function u(f){const c=f.ifShow;let b=!0;return Y(c)&&(b=c),Z(c)&&(b=c(f)),b}const{hasPermission:h}=Qt(),d=$(()=>{const f=rt(e(a)),c=w=>{const{slots:y,customRender:z,format:N,edit:M,editRow:U,flag:te}=w;(!y||!(y!=null&&y.title))&&(w.customTitle=w.title);const S=[Ke,Be].includes(te);return!z&&N&&!M&&!S&&(w.customRender=({text:k,record:r,index:g})=>jn(k,N,r,g)),(M||U)&&!S&&(w.customRender=Bn(w)),Ue(w)};return he(f).filter(w=>h(w.auth)&&u(w)).map(w=>{var y;return(y=w.children)!=null&&y.length&&(w.children=w.children.map(c)),c(w)})});be(()=>e(n).columns,f=>{var c;t.value=f,s=(c=f==null?void 0:f.filter(b=>!b.flag))!=null?c:[]});function i(f,c){!f||!c||s.forEach(b=>{if(b.dataIndex===f){Object.assign(b,c);return}})}function l(f){const c=he(f);if(!Ee(c))return;if(c.length<=0){t.value=[];return}const b=c[0],w=s.map(y=>y.dataIndex);if(!Ne(b)&&!Ee(b))t.value=c;else{const y=c.map(N=>N.toString()),z=[];s.forEach(N=>{var M;z.push(fe(D({},N),{defaultHidden:!y.includes(((M=N.dataIndex)==null?void 0:M.toString())||N.key)}))}),Yt(w,c)||z.sort((N,M)=>{var U,te;return y.indexOf((U=N.dataIndex)==null?void 0:U.toString())-y.indexOf((te=M.dataIndex)==null?void 0:te.toString())}),t.value=z}}function _(f){const{ignoreIndex:c,ignoreAction:b,sort:w}=f||{};let y=pe(e(a));return c&&(y=y.filter(z=>z.flag!==Ke)),b&&(y=y.filter(z=>z.flag!==Be)),w&&(y=rt(y)),y}function v(){return s}function E(f){Ee(f)&&(s=f.filter(c=>!c.flag))}function R(f,c){c.width=f}return{getColumnsRef:a,getCacheColumns:v,getColumns:_,setColumns:l,setColumnWidth:R,getViewColumns:d,setCacheColumnsByField:i,setCacheColumns:E}}function rt(n){const o=[],t=[],s=[];for(const a of n){if(a.fixed==="left"){o.push(a);continue}if(a.fixed==="right"){t.push(a);continue}s.push(a)}return[...o,...s,...t].filter(a=>!a.defaultHidden)}function jn(n,o,t,s){if(!o)return n;if(Z(o))return o(n,t,s);try{const a="date|";if(Ne(o)&&o.startsWith(a)&&n){const u=o.replace(a,"");return u?en(n,u):n}if(tn(o))return o.get(n)}catch(a){return n}}function Wn(n,{getPaginationInfo:o,setPagination:t,setLoading:s,getFieldsValue:a,clearSelectedRowKeys:u,tableData:h},d){const i=Ue({sortInfo:{},filterInfo:{}}),l=W([]),_=W({});ke(()=>{h.value=e(l)}),be(()=>e(n).dataSource,()=>{const{dataSource:r,api:g}=e(n);!g&&r&&(l.value=r)},{immediate:!0});function v(r,g,T){const{clearSelectOnPageChange:F,sortFn:B,filterFn:P}=e(n);F&&u(),t(r);const K={};if(T&&Z(B)){const I=B(T);i.sortInfo=I,K.sortInfo=I}if(g&&Z(P)){const I=P(g);i.filterInfo=I,K.filterInfo=I}M(K)}function E(r){!r||!Array.isArray(r)||r.forEach(g=>{g[oe]||(g[oe]=st()),g.children&&g.children.length&&E(g.children)})}const R=$(()=>e(n).autoCreateKey&&!e(n).rowKey),f=$(()=>{const{rowKey:r}=e(n);return e(R)?oe:r}),c=$(()=>{const r=e(l);if(!r||r.length===0)return e(l);if(e(R)){const g=r[0],T=r[r.length-1];if(g&&T&&(!g[oe]||!T[oe])){const F=he(e(l));F.forEach(B=>{B[oe]||(B[oe]=st()),B.children&&B.children.length&&E(B.children)}),l.value=F}}return e(l)});function b(r,g,T){return ae(this,null,function*(){return l.value[r]&&(l.value[r][g]=T),l.value[r]})}function w(r,g){const T=N(r);if(T){for(const F in T)Reflect.has(g,F)&&(T[F]=g[F]);return T}}function y(r){var B;if(!l.value||l.value.length==0)return;const g=e(f);if(!g)return;const T=Array.isArray(r)?r:[r];function F(P,K){const I=p(P,K);if(I===null||I.index===-1)return;I.data.splice(I.index,1);function p(m,x){var C;if(m==null)return null;for(let A=0;A<m.length;A++){const O=m[A];let G=g;if(Z(g)&&(G=g(O)),O[G]===x)return{index:A,data:m};if(((C=O.children)==null?void 0:C.length)>0){const ne=p(O.children,x);if(ne!=null)return ne}}return null}}for(const P of T)F(l.value,P),F(e(n).dataSource,P);t({total:(B=e(n).dataSource)==null?void 0:B.length})}function z(r,g){var F;g=g!=null?g:(F=l.value)==null?void 0:F.length;const T=an(r)?[r]:r;return e(l).splice(g,0,...T),e(l)}function N(r){if(!l.value||l.value.length==0)return;const g=e(f);if(!g)return;const{childrenColumnName:T="children"}=e(n);return(B=>{let P;return B.some(function K(I){if(typeof g=="function"){if(g(I)===r)return P=I,!0}else if(Reflect.has(I,g)&&I[g]===r)return P=I,!0;return I[T]&&I[T].some(K)}),P})(l.value)}function M(r){return ae(this,null,function*(){var m,x,C;const{api:g,searchInfo:T,defSort:F,fetchSetting:B,beforeFetch:P,afterFetch:K,useSearchForm:I,pagination:p}=e(n);if(!(!g||!Z(g)))try{s(!0);const{pageField:A,sizeField:O,listField:G,totalField:ne}=Object.assign({},Ut,B);let ce={};const{current:Fe=1,pageSize:He=Ge}=e(o);Y(p)&&!p||Y(o)?ce={}:(ce[A]=r&&r.page||Fe,ce[O]=He);const{sortInfo:ze={},filterInfo:Me}=i;let Se=Dn(ce,I?a():{},T,(m=r==null?void 0:r.searchInfo)!=null?m:{},F,ze,Me,(x=r==null?void 0:r.sortInfo)!=null?x:{},(C=r==null?void 0:r.filterInfo)!=null?C:{});P&&Z(P)&&(Se=(yield P(Se))||Se);const re=yield g(Se);_.value=re;const Pe=Array.isArray(re);let ue=Pe?re:it(re,G);const ve=Pe?re.length:it(re,ne);if(Number(ve)){const $e=Math.ceil(ve/He);if(Fe>$e)return t({current:$e}),yield M(r)}return K&&Z(K)&&(ue=(yield K(ue))||ue),l.value=ue,t({total:ve||0}),r&&r.page&&t({current:r.page||1}),d("fetch-success",{items:e(ue),total:ve}),ue}catch(A){d("fetch-error",A),l.value=[],t({total:0})}finally{s(!1)}})}function U(r){l.value=r}function te(){return c.value}function S(){return _.value}function k(r){return ae(this,null,function*(){return yield M(r)})}return Kt(()=>{nn(()=>{e(n).immediate&&M()},16)}),{getDataSourceRef:c,getDataSource:te,getRawDataSource:S,getRowKey:f,setTableData:U,getAutoCreateKey:R,fetch:M,reload:k,updateTableData:b,updateTableDataRecord:w,deleteTableDataRecord:y,insertTableDataRecord:z,findTableDataRecord:N,handleTableChange:v}}function Vn(n){const o=W(e(n).loading);be(()=>e(n).loading,a=>{o.value=a});const t=$(()=>e(o));function s(a){o.value=a}return{getLoading:t,setLoading:s}}function qn(n,o,t){const s=W([]),a=W([]),u=$(()=>{const{rowSelection:c}=e(n);return c?D({selectedRowKeys:e(s),onChange:b=>{i(b)}},Xe(c,["onChange"])):null});be(()=>{var c;return(c=e(n).rowSelection)==null?void 0:c.selectedRowKeys},c=>{i(c)}),be(()=>e(s),()=>{me(()=>{const{rowSelection:c}=e(n);if(c){const{onChange:b}=c;b&&Z(b)&&b(E(),R())}t("selection-change",{keys:E(),rows:R()})})},{deep:!0});const h=$(()=>e(n).autoCreateKey&&!e(n).rowKey),d=$(()=>{const{rowKey:c}=e(n);return e(h)?oe:c});function i(c){var y;s.value=c||[];const b=on(pe(e(o)).concat(pe(e(a))),z=>c==null?void 0:c.includes(z[e(d)]),{children:(y=n.value.childrenColumnName)!=null?y:"children"}),w=[];c==null||c.forEach(z=>{const N=b.find(M=>M[e(d)]===z);N&&w.push(N)}),a.value=w}function l(c){a.value=c}function _(){a.value=[],s.value=[]}function v(c){const w=e(s).findIndex(y=>y===c);w!==-1&&e(s).splice(w,1)}function E(){return e(s)}function R(){return e(a)}function f(){return e(u)}return{getRowSelection:f,getRowSelectionRef:u,getSelectRows:R,getSelectRowKeys:E,setSelectedRowKeys:i,clearSelectedRowKeys:_,deleteSelectRowByKey:v,setSelectedRows:l}}function Un(n,o,t,s,a,u,h){const d=W(167),i=Fn(),l=ln(v,100),_=$(()=>{const{canResize:S,scroll:k}=e(n);return S&&!(k||{}).y});be(()=>{var S;return[e(_),(S=e(a))==null?void 0:S.length]},()=>{l()},{flush:"post"});function v(){me(()=>{M()})}function E(S){var k;d.value=S,(k=i==null?void 0:i.redoModalHeight)==null||k.call(i)}let R,f,c;function b(S,k){const r=S.scrollHeight>S.clientHeight,g=S.scrollWidth>S.clientWidth;r?k.classList.contains("hide-scrollbar-y")&&k.classList.remove("hide-scrollbar-y"):!k.classList.contains("hide-scrollbar-y")&&k.classList.add("hide-scrollbar-y"),g?k.classList.contains("hide-scrollbar-x")&&k.classList.remove("hide-scrollbar-x"):!k.classList.contains("hide-scrollbar-x")&&k.classList.add("hide-scrollbar-x")}function w(S){const{pagination:k}=e(n);let r=2;if(Y(k))r=-8;else if(R=S.querySelector(".ant-pagination"),R){const g=R.offsetHeight;r+=g||0}else r+=24;return r}function y(S){const{pagination:k}=e(n);let r=0;if(!Y(k))if(!f)f=S.querySelector(".ant-table-footer");else{const g=f.offsetHeight;r+=g||0}return r}function z(S){let k=0;return S&&(k=S.offsetHeight),k}function N(S,k){var P,K,I,p,m,x;const{pagination:r,isCanResizeParent:g,useSearchForm:T}=e(n);let F=30,B=0;if(e(u)&&g){let O=10;const G=(K=(P=e(u))==null?void 0:P.offsetHeight)!=null?K:0;let ne=(p=(I=e(h))==null?void 0:I.$el.offsetHeight)!=null?p:0;ne&&(ne+=16),Y(r)&&!r&&(O=0),Y(T)&&!T&&(F=0);const ce=(x=(m=S.querySelector(".ant-table-title"))==null?void 0:m.offsetHeight)!=null?x:0;B=G-ne-ce-12-O}else B=sn(k).bottomIncludeBody;return{paddingHeight:F,bottomIncludeBody:B}}function M(){return ae(this,null,function*(){var x;const{resizeHeightOffset:S,maxHeight:k}=e(n),r=e(a),g=e(o);if(!g)return;const T=g.$el;if(!T||!c&&(c=T.querySelector(".ant-table-body"),!c)||(b(c,T),c.style.height="unset",!e(_)||!e(r)||r.length===0))return;yield me();const F=T.querySelector(".ant-table-thead ");if(!F)return;const B=w(T),P=y(T),K=z(F),{paddingHeight:I,bottomIncludeBody:p}=N(T,F);let m=p-(S||0)-I-B-P-K;m=(x=m>k?k:m)!=null?x:m,E(m),c.style.height=`${m}px`})}Hn(M,{wait:280}),Pn(()=>{M(),me(()=>{l()})});const U=$(()=>{var P,K;let S=0;e(s)&&(S+=60);const k=150,r=e(t).filter(I=>!I.defaultHidden);r.forEach(I=>{S+=Number.parseFloat(I.width)||0});const T=r.filter(I=>!Reflect.has(I,"width")).length;T!==0&&(S+=T*k);const F=e(o);return((K=(P=F==null?void 0:F.$el)==null?void 0:P.offsetWidth)!=null?K:0)>S?"100%":S});return{getScrollRef:$(()=>{const S=e(d),{canResize:k,scroll:r}=e(n);return D({x:e(U),y:k?S:null,scrollToFirstRowOnChange:!1},r)}),redoHeight:v}}function Gn(n,o){let t;function s(u){return ae(this,null,function*(){var i;const{id:h}=u,d=t==null?void 0:t.querySelector(`[data-row-key="${h}"]`);yield me(),t==null||t.scrollTo({top:(i=d==null?void 0:d.offsetTop)!=null?i:0,behavior:"smooth"})})}function a(u){const h=e(n);if(!h)return;const d=h.$el;if(!d||!t&&(t=d.querySelector(".ant-table-body"),!t))return;const i=e(o);if(i)if(u==="top")s(i[0]);else if(u==="bottom")s(i[i.length-1]);else{const l=i.find(_=>_.id===u);l&&s(l)}}return{scrollTo:a}}function Xn(n,o,t){return!o||t?n[oe]:Ne(o)?n[o]:Z(o)?n[o(n)]:null}function Zn(n,{setSelectedRowKeys:o,getSelectRowKeys:t,getAutoCreateKey:s,clearSelectedRowKeys:a,emit:u}){return{customRow:(d,i)=>({onClick:l=>{l==null||l.stopPropagation();function _(){var y;const{rowSelection:v,rowKey:E,clickToRowSelect:R}=e(n);if(!v||!R)return;const f=t()||[],c=Xn(d,E,e(s));if(c===null)return;if(v.type==="checkbox"){const z=(y=l.composedPath)==null?void 0:y.call(l).find(U=>U.tagName==="TR");if(!z)return;const N=z.querySelector("input[type=checkbox]");if(!N||N.hasAttribute("disabled"))return;if(!f.includes(c)){f.push(c),o(f);return}const M=f.findIndex(U=>U===c);f.splice(M,1),o(f);return}if(v.type==="radio"){if(!f.includes(c)){f.length&&a(),o([c]);return}a()}}_(),u("row-click",d,i,l)},onDblclick:l=>{u("row-dbClick",d,i,l)},onContextmenu:l=>{u("row-contextmenu",d,i,l)},onMouseenter:l=>{u("row-mouseenter",d,i,l)},onMouseleave:l=>{u("row-mouseleave",d,i,l)}})}}function Jn(n,o){function t(s,a){const{striped:u,rowClassName:h}=e(n),d=[];return u&&d.push((a||0)%2===1?`${o}-row__striped`:""),h&&Z(h)&&d.push(h(s,a)),d.filter(i=>!!i).join(" ")}return{getRowClassName:t}}const Qn=se({name:"ColumnSetting",__name:"ColumnSetting",emits:["columns-change"],setup(n,{emit:o}){const t=ut(),{t:s}=ye(),a=Re(),u=Xe(a.getRowSelection(),"selectedRowKeys");let h=!1,d=!1,i=!1;const l=W([]),_=W([]),v=W([]),E=W(null),R=Ue({checkAll:!0,checkedList:[],defaultCheckList:[]});let f={};const c=W(!1),b=W(!1),{prefixCls:w}=Ie("basic-column-setting"),y=$(()=>e(a==null?void 0:a.getBindValues)||{});ke(()=>{const p=a.getColumns();setTimeout(()=>{d?d=!1:p.length&&N()},0)}),ke(()=>{const p=e(y);i?i=!1:f=he(p),c.value=!!p.showIndexColumn,b.value=!!p.rowSelection});function z(){const p=[];return a.getColumns({ignoreIndex:!0,ignoreAction:!0}).forEach(m=>{p.push(D({label:m.title||m.customTitle,value:m.dataIndex||m.title},m))}),p}function N(p=!1){return ae(this,null,function*(){var A;_.value=[];const m=e(E);if(m&&m.$el){const O=m.$el;Array.from(O.children).forEach(G=>O.removeChild(G))}yield me();const x=p?he(l.value):z(),C=a.getColumns({ignoreAction:!0,ignoreIndex:!0}).map(O=>O.defaultHidden?"":O.dataIndex||O.title).filter(Boolean);_.value=x,v.value=x,(A=a.setCacheColumns)==null||A.call(a,x),!p&&(l.value=he(x)),R.defaultCheckList=C,R.checkedList=C,R.checkAll=C.length===x.length,h=!1,g()})}function M(p){const m=v.value.map(x=>x.value);v.value.forEach(x=>x.defaultHidden=!p.target.checked),p.target.checked?(R.checkedList=m,P(m)):(R.checkedList=[],P([]))}const U=$(()=>{const p=_.value.length;let m=R.checkedList.length;return m>0&&m<p});function te(p){const m=v.value.length;R.checkAll=p.length===m;const x=e(v).map(C=>C.value);p.sort((C,A)=>x.indexOf(String(C))-x.indexOf(String(A))),e(v).forEach(C=>{C.defaultHidden=!p.includes(C.value)}),P(p)}let S,k=[];function r(){P(l.value),N(!0),c.value=!!f.showIndexColumn,b.value=!!f.rowSelection,a.setProps({showIndexColumn:c.value,rowSelection:b.value?u:void 0}),S.sort(k)}function g(){h||me(()=>{const p=e(E);if(!p)return;const m=p.$el;m&&(S=$n.create(e(m),{animation:500,delay:400,delayOnTouchOnly:!0,handle:".table-column-drag-icon ",onEnd:x=>{const{oldIndex:C,newIndex:A}=x;if(ot(C)||ot(A)||C===A)return;const O=he(v.value);C>A?(O.splice(A,0,O[C]),O.splice(C+1,1)):(O.splice(A+1,0,O[C]),O.splice(C,1)),v.value=O,P(O.filter(G=>R.checkedList.includes(G.value)))}}),k=S.toArray(),h=!0)})}function T(p){i=!0,d=!0,a.setProps({showIndexColumn:p.target.checked})}function F(p){i=!0,d=!0,a.setProps({rowSelection:p.target.checked?u:void 0})}function B(p,m){var O;if(!R.checkedList.includes(p.dataIndex))return;const x=z().filter(G=>R.checkedList.includes(G.dataIndex)),C=p.fixed===m?!1:m,A=x.findIndex(G=>G.dataIndex===p.dataIndex);A!==-1&&(x[A].fixed=C),p.fixed=C,C&&!p.width&&(p.width=100),I(p),(O=a.setCacheColumnsByField)==null||O.call(a,p.dataIndex,{fixed:C}),P(x)}function P(p){i=!0,d=!0,a.setColumns(p);const m=e(v).map(x=>{const C=p.findIndex(A=>A===x.value||typeof A!="string"&&A.dataIndex===x.value)!==-1;return{dataIndex:x.value,fixed:x.fixed,visible:C}});o("columns-change",m)}function K(){return Z(t.getPopupContainer)?t.getPopupContainer():ft()}function I(p){v.value.forEach(m=>{m.value===p.dataIndex&&Object.assign(m,p)})}return(p,m)=>{const x=Bt("a-button");return j(),J(e(we),{placement:"top"},{title:H(()=>[le("span",null,X(e(s)("component.table.settingColumn")),1)]),default:H(()=>[L(e(Cn),{placement:"bottomLeft",trigger:"click",onOpenChange:g,overlayClassName:`${e(w)}__column-list`,getPopupContainer:K},{title:H(()=>[le("div",{class:Ce(`${e(w)}__popover-title`)},[L(e(xe),{indeterminate:U.value,checked:R.checkAll,"onUpdate:checked":m[0]||(m[0]=C=>R.checkAll=C),onChange:M},{default:H(()=>[ie(X(e(s)("component.table.settingColumnShow")),1)]),_:1},8,["indeterminate","checked"]),L(e(xe),{checked:c.value,"onUpdate:checked":m[1]||(m[1]=C=>c.value=C),onChange:T},{default:H(()=>[ie(X(e(s)("component.table.settingIndexColumnShow")),1)]),_:1},8,["checked"]),L(e(xe),{checked:b.value,"onUpdate:checked":m[2]||(m[2]=C=>b.value=C),onChange:F,disabled:!e(u)},{default:H(()=>[ie(X(e(s)("component.table.settingSelectColumnShow")),1)]),_:1},8,["checked","disabled"]),L(x,{size:"small",type:"link",onClick:r},{default:H(()=>[ie(X(e(s)("common.resetText")),1)]),_:1})],2)]),content:H(()=>[L(e(cn),null,{default:H(()=>[L(e(xe).Group,{value:R.checkedList,"onUpdate:value":m[3]||(m[3]=C=>R.checkedList=C),onChange:te,ref_key:"columnListRef",ref:E},{default:H(()=>[(j(!0),ge(et,null,Ve(_.value,C=>(j(),ge(et,{key:C.value},["ifShow"in C&&!C.ifShow?ee("",!0):(j(),ge("div",{key:0,class:Ce(`${e(w)}__check-item`)},[L(e(bn),{class:"table-column-drag-icon"}),L(e(xe),{value:C.value},{default:H(()=>[ie(X(C.label),1)]),_:2},1032,["value"]),L(e(we),{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:K},{title:H(()=>[ie(X(e(s)("component.table.settingFixedLeft")),1)]),default:H(()=>[L(lt,{icon:"line-md:arrow-align-left",class:Ce([`${e(w)}__fixed-left`,{active:C.fixed==="left",disabled:!R.checkedList.includes(C.value)}]),onClick:A=>B(C,"left")},null,8,["class","onClick"])]),_:2},1024),L(e(dt),{type:"vertical"}),L(e(we),{placement:"bottomLeft",mouseLeaveDelay:.4,getPopupContainer:K},{title:H(()=>[ie(X(e(s)("component.table.settingFixedRight")),1)]),default:H(()=>[L(lt,{icon:"line-md:arrow-align-left",class:Ce([`${e(w)}__fixed-right`,{active:C.fixed==="right",disabled:!R.checkedList.includes(C.value)}]),onClick:A=>B(C,"right")},null,8,["class","onClick"])]),_:2},1024)],2))],64))),128))]),_:1},8,["value"])]),_:1})]),default:H(()=>[L(e(Sn))]),_:1},8,["overlayClassName"])]),_:1})}}}),Yn=se({name:"SizeSetting",__name:"SizeSetting",setup(n){const o=Re(),{t}=ye(),s=W([o.getSize()]),a=({key:u})=>{s.value=[u],o.setProps({size:u})};return(u,h)=>(j(),J(e(we),{placement:"top"},{title:H(()=>[le("span",null,X(e(t)("component.table.settingDens")),1)]),default:H(()=>[L(e(vn),{placement:"bottom",trigger:["click"],getPopupContainer:e(ft)},{overlay:H(()=>[L(e(Oe),{onClick:a,selectable:"",selectedKeys:s.value,"onUpdate:selectedKeys":h[0]||(h[0]=d=>s.value=d)},{default:H(()=>[L(e(Oe).Item,{key:"default"},{default:H(()=>[le("span",null,X(e(t)("component.table.settingDensDefault")),1)]),_:1}),L(e(Oe).Item,{key:"middle"},{default:H(()=>[le("span",null,X(e(t)("component.table.settingDensMiddle")),1)]),_:1}),L(e(Oe).Item,{key:"small"},{default:H(()=>[le("span",null,X(e(t)("component.table.settingDensSmall")),1)]),_:1})]),_:1},8,["selectedKeys"])]),default:H(()=>[L(e(wn))]),_:1},8,["getPopupContainer"])]),_:1}))}}),ea=se({name:"RedoSetting",__name:"RedoSetting",setup(n){const o=Re(),{t}=ye();function s(){o.reload()}return(a,u)=>(j(),J(e(we),{placement:"top"},{title:H(()=>[le("span",null,X(e(t)("common.redo")),1)]),default:H(()=>[L(e(yn),{onClick:s})]),_:1}))}}),ta=se({name:"FullScreenSetting",__name:"FullScreenSetting",setup(n){const o=Re(),{t}=ye(),{toggle:s,isFullscreen:a}=rn(o.wrapRef);return(u,h)=>(j(),J(e(we),{placement:"top"},{title:H(()=>[le("span",null,X(e(t)("component.table.settingFullScreen")),1)]),default:H(()=>[e(a)?(j(),J(e(Tn),{key:1,onClick:e(s)},null,8,["onClick"])):(j(),J(e(_n),{key:0,onClick:e(s)},null,8,["onClick"]))]),_:1}))}}),na={class:"table-settings"},aa=se({name:"TableSetting",__name:"index",props:{setting:{type:Object,default:()=>({})}},emits:["columns-change"],setup(n,{emit:o}){const t=n,s=Re(),a=$(()=>D({redo:!0,size:!0,setting:!0,fullScreen:!1},t.setting));function u(d){o("columns-change",d)}function h(){return s?e(s.wrapRef):document.body}return(d,i)=>(j(),ge("div",na,[a.value.redo?(j(),J(ea,{key:0,getPopupContainer:h})):ee("",!0),a.value.size?(j(),J(Yn,{key:1,getPopupContainer:h})):ee("",!0),a.value.setting?(j(),J(Qn,{key:2,onColumnsChange:u,getPopupContainer:h})):ee("",!0),a.value.fullScreen?(j(),J(ta,{key:3,getPopupContainer:h})):ee("",!0)]))}}),oa=se({name:"BasicTableTitle",__name:"TableTitle",props:{title:{type:[Function,String]},getSelectRows:{type:Function},helpMessage:{type:[String,Array]}},setup(n){const o=n,{prefixCls:t}=Ie("basic-table-title"),s=$(()=>{const{title:a,getSelectRows:u=()=>{}}=o;let h=a;return Z(a)&&(h=a({selectRows:u()})),h});return(a,u)=>s.value?(j(),J(e(un),{key:0,class:Ce(e(t)),helpMessage:n.helpMessage},{default:H(()=>[ie(X(s.value),1)]),_:1},8,["class","helpMessage"])):ee("",!0)}}),la={style:{width:"100%"}},sa={key:0,style:{margin:"5px"}},ia={class:"flex items-center"},ca=se({name:"BasicTableHeader",__name:"TableHeader",props:{title:{type:[Function,String]},tableSetting:{type:Object},showTableSetting:{type:Boolean},titleHelpMessage:{type:[String,Array],default:""}},emits:["columns-change"],setup(n,{emit:o}){const{prefixCls:t}=Ie("basic-table-header");function s(a){o("columns-change",a)}return(a,u)=>(j(),ge("div",la,[a.$slots.headerTop?(j(),ge("div",sa,[de(a.$slots,"headerTop")])):ee("",!0),le("div",ia,[a.$slots.tableTitle?de(a.$slots,"tableTitle",{key:0}):ee("",!0),!a.$slots.tableTitle&&n.title?(j(),J(oa,{key:1,helpMessage:n.titleHelpMessage,title:n.title},null,8,["helpMessage","title"])):ee("",!0),le("div",{class:Ce(`${e(t)}__toolbar`)},[de(a.$slots,"toolbar"),a.$slots.toolbar&&n.showTableSetting?(j(),J(e(dt),{key:0,type:"vertical"})):ee("",!0),n.showTableSetting?(j(),J(aa,{key:1,setting:n.tableSetting,onColumnsChange:s},null,8,["setting"])):ee("",!0)],2)])]))}});function ra(n,o,t){return{getHeaderProps:$(()=>{const{title:a,showTableSetting:u,titleHelpMessage:h,tableSetting:d}=e(n),i=!o.tableTitle&&!a&&!o.toolbar&&!u;return i&&!Ne(a)?{}:{title:i?null:()=>qe(ca,{title:a,titleHelpMessage:h,showTableSetting:u,tableSetting:d,onColumnsChange:t.onColumnsChange},D(D(D({},o.toolbar?{toolbar:()=>We(o,"toolbar")}:{}),o.tableTitle?{tableTitle:()=>We(o,"tableTitle")}:{}),o.headerTop?{headerTop:()=>We(o,"headerTop")}:{}))}})}}function ua(n,o,t){const s=W([]),a=$(()=>e(n).autoCreateKey&&!e(n).rowKey),u=$(()=>{const{rowKey:v}=e(n);return e(a)?oe:v}),h=$(()=>{const{isTreeTable:v}=e(n);return v?{expandedRowKeys:e(s),onExpandedRowsChange:E=>{s.value=E,t("expanded-rows-change",E)}}:{}});function d(){const v=l();s.value=v}function i(v){const{isTreeTable:E}=e(n);E&&(s.value=[...s.value,...v])}function l(v){const E=[],{childrenColumnName:R}=e(n);return pe(v||e(o)).forEach(f=>{E.push(f[e(u)]);const c=f[R||"children"];c!=null&&c.length&&E.push(...l(c))}),E}function _(){s.value=[]}return{getExpandOption:h,expandAll:d,expandRows:i,collapseAll:_}}function fa(n,o,t,s){const a=$(()=>(e(s)||[]).length===0),u=$(()=>{const{summaryFunc:d,showSummary:i,summaryData:l}=e(n);return i&&!e(a)?()=>qe(Rn,{summaryFunc:d,summaryData:l,scroll:e(o)}):void 0});ke(()=>{h()});function h(){const{showSummary:d}=e(n);!d||e(a)||me(()=>{const i=e(t);if(!i)return;const l=i.$el.querySelector(".ant-table-content");fn({el:l,name:"scroll",listener:()=>{const _=i.$el.querySelector(".ant-table-footer .ant-table-content");!_||!l||(_.scrollLeft=l.scrollLeft)},wait:0,options:!0})})}return{getFooterProps:u}}function da(n,o,t,s){const a=$(()=>{const{formConfig:i}=e(n),{submitButtonOptions:l}=i||{};return fe(D({showAdvancedButton:!0},i),{submitButtonOptions:D({loading:e(s)},l),compact:!0})}),u=$(()=>Object.keys(o).map(l=>l.startsWith("form-")?l:null).filter(l=>!!l));function h(i){var l,_;return i&&(_=(l=i==null?void 0:i.replace)==null?void 0:l.call(i,/form-/,""))!=null?_:""}function d(i){const{handleSearchInfoFn:l}=e(n);l&&Z(l)&&(i=l(i)||i),t({searchInfo:i,page:1})}return{getFormProps:a,replaceFormSlotKey:h,getFormSlotKeys:u,handleSearchInfoChange:d}}const Fa=se({name:"BasicTable",__name:"BasicTable",props:In,emits:["fetch-success","fetch-error","selection-change","register","row-click","row-dbClick","row-contextmenu","row-mouseenter","row-mouseleave","edit-end","edit-cancel","edit-row-end","edit-change","expanded-rows-change","change","columns-change"],setup(n,{expose:o,emit:t}){const s=n,a=ut(),u=Nt(),h=W(null),d=W([]),i=W(null),l=W(null),_=W(),{prefixCls:v}=Ie("basic-table"),[E,R]=Xt(),f=$(()=>D(D({},s),e(_))),c=zt(dn,!1);ke(()=>{e(c)&&s.canResize&&hn()});const{getLoading:b,setLoading:w}=Vn(f),{getPaginationInfo:y,getPagination:z,setPagination:N,setShowPagination:M,getShowPagination:U}=Kn(f),{getRowSelection:te,getRowSelectionRef:S,getSelectRows:k,setSelectedRows:r,clearSelectedRowKeys:g,getSelectRowKeys:T,deleteSelectRowByKey:F,setSelectedRowKeys:B}=qn(f,d,t),{handleTableChange:P,getDataSourceRef:K,getDataSource:I,getRawDataSource:p,setTableData:m,updateTableDataRecord:x,deleteTableDataRecord:C,insertTableDataRecord:A,findTableDataRecord:O,fetch:G,getRowKey:ne,reload:ce,getAutoCreateKey:Fe,updateTableData:He}=Wn(f,{tableData:d,getPaginationInfo:y,setLoading:w,setPagination:N,getFieldsValue:R.getFieldsValue,clearSelectedRowKeys:g},t);function ze(V,Q,q,Te){P(V,Q,q),t("change",V,Q,q);const{onChange:je}=e(f);je&&Z(je)&&je(V,Q,q,Te)}const{getViewColumns:Me,getColumns:Se,setCacheColumnsByField:re,setCacheColumns:Pe,setColumnWidth:ue,setColumns:ve,getColumnsRef:$e,getCacheColumns:mt}=Mn(f,y),{getScrollRef:Ze,redoHeight:Je}=Un(f,h,$e,S,K,i,l),{scrollTo:pt}=Gn(h,K),{customRow:Ct}=Zn(f,{setSelectedRowKeys:B,getSelectRowKeys:T,clearSelectedRowKeys:g,getAutoCreateKey:Fe,emit:t}),{getRowClassName:bt}=Jn(f,v),{getExpandOption:St,expandAll:vt,expandRows:wt,collapseAll:yt}=ua(f,d,t),_t={onColumnsChange:V=>{var Q,q;t("columns-change",V),(q=(Q=e(f)).onColumnsChange)==null||q.call(Q,V)}},{getHeaderProps:Tt}=ra(f,u,_t),{getFooterProps:xt}=fa(f,Ze,h,K),{getFormProps:kt,replaceFormSlotKey:Rt,getFormSlotKeys:It,handleSearchInfoChange:Ft}=da(f,u,G,b),_e=$(()=>{const V=e(K);let Q=D(fe(D(D(fe(D({},a),{customRow:Ct}),e(f)),e(Tt)),{scroll:e(Ze),loading:e(b),tableLayout:"fixed",rowSelection:e(S),rowKey:e(ne),columns:pe(e(Me)),pagination:pe(e(y)),dataSource:V,footer:e(xt)}),e(St));return Q=Xe(Q,["class","onChange"]),Q}),Ht=$(()=>{const V=e(_e);return[v,a.class,{[`${v}-form-container`]:V.useSearchForm,[`${v}--inset`]:V.inset}]}),Pt=$(()=>{const{emptyDataIsShowTable:V,useSearchForm:Q}=e(f);return V||!Q?!0:!!e(K).length});function $t(V){_.value=D(D({},e(_)),V)}const Ae={reload:ce,getSelectRows:k,setSelectedRows:r,clearSelectedRowKeys:g,getSelectRowKeys:T,deleteSelectRowByKey:F,setPagination:N,setTableData:m,updateTableDataRecord:x,deleteTableDataRecord:C,insertTableDataRecord:A,findTableDataRecord:O,redoHeight:Je,setSelectedRowKeys:B,setColumns:ve,setLoading:w,getDataSource:I,getRawDataSource:p,setProps:$t,getRowSelection:te,getPaginationRef:z,getColumns:Se,getCacheColumns:mt,emit:t,updateTableData:He,setShowPagination:M,getShowPagination:U,setCacheColumnsByField:re,expandAll:vt,expandRows:wt,collapseAll:yt,scrollTo:pt,getSize:()=>e(_e).size,setCacheColumns:Pe};return Gt(fe(D({},Ae),{wrapRef:i,getBindValues:_e})),t("register",Ae,R),o(D({tableElRef:h},Ae)),(V,Q)=>(j(),ge("div",{ref_key:"wrapRef",ref:i,class:Ce(Ht.value)},[_e.value.useSearchForm?(j(),J(e(Wt),nt({key:0,ref_key:"formRef",ref:l,submitOnReset:""},e(kt),{tableAction:Ae,onRegister:e(E),onSubmit:e(Ft),onAdvancedChange:e(Je)}),tt({_:2},[Ve(e(It),q=>({name:e(Rt)(q),fn:H(Te=>[de(V.$slots,q,De(Le(Te||{})))])}))]),1040,["onRegister","onSubmit","onAdvancedChange"])):ee("",!0),Mt(L(e(xn),nt({ref_key:"tableElRef",ref:h},_e.value,{rowClassName:e(bt),onChange:ze,onResizeColumn:e(ue)}),tt({headerCell:H(({column:q})=>[de(V.$slots,"headerCell",De(Le({column:q})),()=>[L(On,{column:q},null,8,["column"])])]),bodyCell:H(q=>[de(V.$slots,"bodyCell",De(Le(q||{})))]),_:2},[Ve(Object.keys(V.$slots),q=>({name:q,fn:H(Te=>[de(V.$slots,q,De(Le(Te||{})))])}))]),1040,["rowClassName","onResizeColumn"]),[[jt,Pt.value]])],2))}});export{Fa as _,On as a};
