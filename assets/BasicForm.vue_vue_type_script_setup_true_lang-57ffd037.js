var Le=Object.defineProperty;var ve=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable;var ge=(t,o,s)=>o in t?Le(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,L=(t,o)=>{for(var s in o||(o={}))Pe.call(o,s)&&ge(t,s,o[s]);if(ve)for(var s of ve(o))$e.call(o,s)&&ge(t,s,o[s]);return t};var _=(t,o,s)=>new Promise((a,A)=>{var f=c=>{try{w(s.next(c))}catch(h){A(h)}},p=c=>{try{w(s.throw(c))}catch(h){A(h)}},w=c=>c.done?a(c.value):Promise.resolve(c.value).then(f,p);w((s=s.apply(t,o)).next())});import{u as n,g as Re,c as X,w as Q,am as Ne,x as me,H as be,h as Se,d as Ue,J as Ce,r as Fe,f as J,o as We,Z as le,a8 as we,a9 as re,l as Ve,N as ie,_ as ke,aa as fe,ad as Be,ai as ue,aj as de,F as He,ac as Ie,ak as Ke}from"./vue-ea98dac5.js";import{_ as Ye}from"./FormItem.vue_vue_type_script_lang-1946c202.js";import{b as Xe,c as qe,_ as ze}from"./BasicForm.vue_vue_type_style_index_0_lang-c9b7c50c.js";import{h as Ge,d as Oe,a as Je}from"./helper-1d3a8892.js";import{O as Qe,Q as K,R as Z,n as ae,q as oe,S as q,U as M,V as Te,W as C,c as z,N as Ze,u as xe,X as De,Y as pe,d as _e,h as Me}from"./index.js";import{g as he}from"./get-3d19de2f.js";import{i as et}from"./isNumber-f0336cfd.js";import{i as tt}from"./isBoolean-9388e2d6.js";import{u as nt}from"./uniqBy-3d1a97d8.js";import{u as st}from"./index-4b210e61.js";import{R as rt,y as it}from"./antd-c2e94c83.js";function Ee(t,o){return t==null?!0:Qe(t,o)}function ot(t,o,s){const a=/^\[(.+)\]$/;if(a.test(t)){const A=t.match(a);if(A&&A[1]){const f=A[1].split(",");return o=Array.isArray(o)?o:[o],f.forEach((p,w)=>{q(s,p.trim(),o[w])}),!0}}}function at(t,o,s){const a=/^\{(.+)\}$/;if(a.test(t)){const A=t.match(a);if(A&&A[1]){const f=A[1].split(",");return o=K(o)?o:{},f.forEach(p=>{q(s,p.trim(),o[p.trim()])}),!0}}}function ct({defaultValueRef:t,getSchema:o,formModel:s,getProps:a}){function A(c){var F,E;if(!K(c))return{};const h={};for(const I of Object.entries(c)){let[,u]=I;const[d]=I;if(!d||Z(u)&&u.length===0||ae(u))continue;const O=n(a).transformDateFunc;K(u)&&(u=O==null?void 0:O(u)),Z(u)&&((F=u[0])!=null&&F.format)&&((E=u[1])!=null&&E.format)&&(u=u.map(y=>O==null?void 0:O(y))),oe(u)&&(u===""?u=void 0:u=u.trim()),!ot(d,u,h)&&!at(d,u,h)&&q(h,d,u)}return f(h)}function f(c){const h=n(a).fieldMapToTime;if(!h||!Array.isArray(h))return c;for(const[F,[E,I],u="YYYY-MM-DD"]of h){if(!F||!E||!I)continue;if(!he(c,F)){Ee(c,F);continue}const[d,O]=he(c,F),[y,b]=Array.isArray(u)?u:[u,u];!M(d)&&!Te(d)&&q(c,E,p(d,y)),!M(O)&&!Te(O)&&q(c,I,p(O,b)),Ee(c,F)}return c}function p(c,h){return h==="timestamp"?C(c).unix():h==="timestampStartDay"?C(c).startOf("day").unix():C(c).format(h)}function w(){const c=n(o),h={};c.forEach(F=>{const{defaultValue:E,defaultValueObj:I}=F,u=Object.keys(I||{});u.length&&u.map(d=>{h[d]=I[d],s[d]===void 0&&(s[d]=I[d])}),M(E)||(h[F.field]=E,s[F.field]===void 0&&(s[F.field]=E))}),t.value=z(h)}return{handleFormValues:A,initDefault:w}}const Y=24;function lt({advanceState:t,emit:o,getProps:s,getSchema:a,formModel:A,defaultValueRef:f}){const p=Re(),{realWidthRef:w,screenEnum:c,screenRef:h}=Ze(),F=X(()=>{if(!t.isAdvanced)return 0;const y=n(s).emptySpan||0;if(et(y))return y;if(K(y)){const{span:b=0}=y,j=n(h);return y[j.toLowerCase()]||b||0}return 0}),E=xe(d,30);Q([()=>n(a),()=>t.isAdvanced,()=>n(w)],()=>{const{showAdvancedButton:y}=n(s);y&&E()},{immediate:!0});function I(y,b=0,j=!1){const P=n(w),U=parseInt(y.md)||parseInt(y.xs)||parseInt(y.sm)||y.span||Y,$=parseInt(y.lg)||U,S=parseInt(y.xl)||$,R=parseInt(y.xxl)||S;return P<=c.LG?b+=U:P<c.XL?b+=$:P<c.XXL?b+=S:b+=R,j?(t.hideAdvanceBtn=!1,b<=Y*2?(t.hideAdvanceBtn=!0,t.isAdvanced=!0):b>Y*2&&b<=Y*(n(s).autoAdvancedLine||3)?t.hideAdvanceBtn=!1:t.isLoad||(t.isLoad=!0,t.isAdvanced=!t.isAdvanced),{isAdvanced:t.isAdvanced,itemColSum:b}):b>Y*(n(s).alwaysShowLines||1)?{isAdvanced:t.isAdvanced,itemColSum:b}:{isAdvanced:!0,itemColSum:b}}const u=Ne({});function d(){var P;let y=0,b=0;const{baseColProps:j={}}=n(s);for(const U of n(a)){const{show:$,colProps:S}=U;let R=!0;if(tt($)&&(R=$),ae($)&&(R=$({schema:U,model:A,field:U.field,values:L(L({},n(f)),A)})),R&&(S||j)){const{itemColSum:W,isAdvanced:G}=I(L(L({},j),S),y);y=W||0,G&&(b=y),u[U.field]=G}}(P=p==null?void 0:p.proxy)==null||P.$forceUpdate(),t.actionSpan=b%Y+n(F),I(n(s).actionColOptions||{span:Y},y,!0),o("advanced-change")}function O(){t.isAdvanced=!t.isAdvanced}return{handleToggleAdvanced:O,fieldsIsAdvancedMap:u}}function ft(t,o={}){const s=/^\[(.+)\]$/;if(s.test(t)){const a=t.match(s);if(a&&a[1]){const A=a[1].split(",");if(!A.length)return;const f=[];return A.forEach((p,w)=>{q(f,w,o[p.trim()])}),f.filter(Boolean).length?f:void 0}}}function ut(t,o={}){const s=/^\{(.+)\}$/;if(s.test(t)){const a=t.match(s);if(a&&a[1]){const A=a[1].split(",");if(!A.length)return;const f={};return A.forEach(p=>{q(f,p.trim(),o[p.trim()])}),Object.values(f).filter(Boolean).length?f:void 0}}}function dt({emit:t,getProps:o,formModel:s,getSchema:a,defaultValueRef:A,formElRef:f,schemaRef:p,handleFormValues:w}){function c(){return _(this,null,function*(){const{resetFunc:e,submitOnReset:r}=n(o);e&&ae(e)&&(yield e()),n(f)&&(Object.keys(s).forEach(i=>{const m=n(a).find(x=>x.field===i),g=m==null?void 0:m.defaultValueObj,T=Object.keys(g||{});T.length&&T.map(x=>{s[x]=g[x]}),s[i]=pt(m,A,i)}),me(()=>S()),t("reset",be(s)),r&&W())})}const h=()=>n(a).map(e=>[...e.fields||[],e.field]).flat(1).filter(Boolean);function F(e){return _(this,null,function*(){if(Object.keys(e).length===0)return;const r=h(),v=".",i=r.filter(g=>String(g).indexOf(v)>=0),m=[];r.forEach(g=>{const T=n(a).find(V=>V.field===g);let x=he(e,g);const ce=Reflect.has(e,g);x=Ge(T==null?void 0:T.component,x);const{componentProps:ee}=T||{};let N=ee;typeof ee=="function"&&(N=N({formModel:n(s),formActionType:G}));const te=ft(g,e)||ut(g,e);if(ce||te){const V=te||x;if(j(g))if(Array.isArray(V)){const k=[];for(const l of V)k.push(l?C(l):null);n(s)[g]=k}else n(s)[g]=V?N!=null&&N.valueFormat?V:C(V):null;else n(s)[g]=V;N!=null&&N.onChange&&(N==null||N.onChange(V)),m.push(g)}else i.forEach(V=>{try{const k=V.split(".").reduce((l,D)=>l[D],e);De(k)&&(n(s)[V]=n(k),m.push(V))}catch(k){De(A.value[V])&&(n(s)[V]=z(n(A.value[V])))}})}),P(m).catch(g=>{})})}function E(e){return _(this,null,function*(){const r=z(n(a));if(!e)return;let v=oe(e)?[e]:e;oe(e)&&(v=[e]);for(const i of v)I(i,r);p.value=r})}function I(e,r){if(oe(e)){const v=r.findIndex(i=>i.field===e);v!==-1&&(delete s[e],r.splice(v,1))}}function u(e,r,v=!1){return _(this,null,function*(){const i=z(n(a)),m=Array.isArray(e)?e.map(x=>x.field):[e.field];if(i.find(x=>m.includes(x.field))){pe("There are schemas that have already been added");return}const g=i.findIndex(x=>x.field===r),T=K(e)?[e]:e;!r||g===-1||v?v?i.unshift(...T):i.push(...T):g!==-1&&i.splice(g+1,0,...T),p.value=i,y(e)})}function d(e){return _(this,null,function*(){let r=[];if(K(e)&&r.push(e),Z(e)&&(r=[...e]),!r.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){pe("All children of the form Schema array that need to be updated must contain the `field` field");return}p.value=r})}function O(e){return _(this,null,function*(){let r=[];if(K(e)&&r.push(e),Z(e)&&(r=[...e]),!r.every(m=>m.component==="Divider"||Reflect.has(m,"field")&&m.field)){pe("All children of the form Schema array that need to be updated must contain the `field` field");return}const i=[];n(a).forEach(m=>{let g;if(r.forEach(T=>{m.field===T.field&&(g=T)}),g!==void 0&&m.field===g.field){const T=_e(m,g);i.push(T)}else i.push(m)}),y(i),p.value=nt(i,"field")})}function y(e){let r=[];K(e)&&r.push(e),Z(e)&&(r=[...e]);const v={},i=b();r.forEach(m=>{m.component!="Divider"&&Reflect.has(m,"field")&&m.field&&!M(m.defaultValue)&&(!(m.field in i)||M(i[m.field]))&&(v[m.field]=m.defaultValue)}),F(v)}function b(){return n(f)?w(be(n(s))):{}}function j(e){return n(a).some(r=>r.field===e&&r.component?Oe.includes(r.component):!1)}function P(e){return _(this,null,function*(){var v;const r=yield(v=n(f))==null?void 0:v.validateFields(e);return w(r)})}function U(e){return _(this,null,function*(){var r;yield(r=n(f))==null?void 0:r.setProps(e)})}function $(e){return _(this,null,function*(){var i;let r;e===void 0?r=h():r=e===Array.isArray(e)?e:void 0;const v=yield(i=n(f))==null?void 0:i.validate(r);return w(v)})}function S(e){return _(this,null,function*(){var r;yield(r=n(f))==null?void 0:r.clearValidate(e)})}function R(e,r){return _(this,null,function*(){var v;yield(v=n(f))==null?void 0:v.scrollToField(e,r)})}function W(e){return _(this,null,function*(){e&&e.preventDefault();const{submitFunc:r}=n(o);if(r&&ae(r)){yield r();return}if(n(f))try{const i=yield $();t("submit",i)}catch(i){if((i==null?void 0:i.outOfDate)===!1&&(i!=null&&i.errorFields))return;throw new Error(i)}})}const G={getFieldsValue:b,setFieldsValue:F,resetFields:c,updateSchema:O,resetSchema:d,setProps:U,removeSchemaByField:E,appendSchemaByField:u,clearValidate:S,validateFields:P,validate:$,submit:W,scrollToField:R};return{handleSubmit:W,clearValidate:S,validate:$,validateFields:P,getFieldsValue:b,updateSchema:O,resetSchema:d,appendSchemaByField:u,removeSchemaByField:E,resetFields:c,setFieldsValue:F,scrollToField:R}}function pt(t,o,s){let a=z(o.value[s]);return mt(t)?a||"":(!a&&t&&ht(t)&&(a=[0,0]),!a&&t&&t.component==="ApiTree"&&(a=[]),a)}function ht(t){if(t.component==="Slider"&&t.componentProps&&"range"in t.componentProps)return!0}function mt(t){return(t==null?void 0:t.component)&&Je.includes(t.component)}function yt(A){return _(this,arguments,function*({getSchema:t,getProps:o,formElRef:s,isInitedDefault:a}){Se(()=>_(this,null,function*(){if(n(a)||!n(o).autoFocusFirstItem)return;yield me();const f=n(t),p=n(s),w=p==null?void 0:p.$el;if(!p||!w||!f||f.length===0)return;const c=f[0];if(!c.component||!c.component.includes("Input"))return;const h=w.querySelector(".ant-row:first-child input");h&&(h==null||h.focus())}))})}const Ot=Ue({name:"BasicForm",__name:"BasicForm",props:Xe,emits:["advanced-change","reset","submit","register","field-value-change"],setup(t,{expose:o,emit:s}){const a=t,A=Ce(),f=Fe({}),p=st(),w=Fe({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),c=J({}),h=J(!1),F=J(),E=J(null),I=J(null),{prefixCls:u}=Me("basic-form"),d=X(()=>L(L({},a),n(F))),O=X(()=>[u,{[`${u}--compact`]:n(d).compact}]),y=X(()=>{const{baseRowStyle:l={},rowProps:D}=n(d);return L({style:l},D)}),b=X(()=>L(L(L({},A),a),n(d))),j=X(()=>{const l=n(E)||n(d).schemas;for(const D of l){const{defaultValue:B,component:H,componentProps:ne,isHandleDateDefaultValue:je=!0}=D;if(je&&B&&H&&Oe.includes(H)){const se=ne?ne.valueFormat:null;if(!Array.isArray(B))D.defaultValue=se?C(B).format(se):C(B);else{const ye=[];B.forEach(Ae=>{ye.push(se?C(Ae).format(se):C(Ae))}),D.defaultValue=ye}}}return n(d).showAdvancedButton?z(l.filter(D=>D.component!=="Divider")):z(l)}),{handleToggleAdvanced:P,fieldsIsAdvancedMap:U}=lt({advanceState:w,emit:s,getProps:d,getSchema:j,formModel:f,defaultValueRef:c}),{handleFormValues:$,initDefault:S}=ct({getProps:d,defaultValueRef:c,getSchema:j,formModel:f});yt({getSchema:j,getProps:d,isInitedDefault:h,formElRef:I});const{handleSubmit:R,setFieldsValue:W,clearValidate:G,validate:e,validateFields:r,getFieldsValue:v,updateSchema:i,resetSchema:m,appendSchemaByField:g,removeSchemaByField:T,resetFields:x,scrollToField:ce}=dt({emit:s,getProps:d,formModel:f,getSchema:j,defaultValueRef:c,formElRef:I,schemaRef:E,handleFormValues:$});qe({resetAction:x,submitAction:R}),Q(()=>n(d).model,()=>{const{model:l}=n(d);l&&W(l)},{immediate:!0}),Q(()=>a.schemas,l=>{m(l!=null?l:[])}),Q(()=>j.value,l=>{me(()=>{var D;(D=p==null?void 0:p.redoModalHeight)==null||D.call(p)}),!n(h)&&l!=null&&l.length&&(S(),h.value=!0)}),Q(()=>f,xe(()=>{n(d).submitOnChange&&R()},300),{deep:!0});function ee(l){return _(this,null,function*(){F.value=_e(n(F)||{},l)})}function N(l,D,B){f[l]=D,s("field-value-change",l,D),B&&B.itemProps&&!B.itemProps.autoLink&&r([l]).catch(H=>{})}function te(l){const{autoSubmitOnEnter:D}=n(d);if(D&&l.key==="Enter"&&l.target&&l.target instanceof HTMLElement){const B=l.target;B&&B.tagName&&B.tagName.toUpperCase()=="INPUT"&&R()}}const V={getFieldsValue:v,setFieldsValue:W,resetFields:x,updateSchema:i,resetSchema:m,setProps:ee,removeSchemaByField:T,appendSchemaByField:g,clearValidate:G,validateFields:r,validate:e,submit:R,scrollToField:ce},k=X(()=>L(L({},d.value),w));return o(L({},V)),We(()=>{S(),s("register",V)}),(l,D)=>(le(),we(n(it),Ie(b.value,{class:O.value,ref_key:"formElRef",ref:I,model:f,onKeypress:Ke(te,["enter"])}),{default:re(()=>[Ve(n(rt),ue(de(y.value)),{default:re(()=>[ie(l.$slots,"formHeader"),(le(!0),ke(He,null,fe(j.value,B=>(le(),we(Ye,{key:B.field,isAdvanced:n(U)[B.field],tableAction:l.tableAction,formActionType:V,schema:B,formProps:d.value,allDefaultValues:c.value,formModel:f,setFormModel:N},Be({_:2},[fe(Object.keys(l.$slots),H=>({name:H,fn:re(ne=>[ie(l.$slots,H,ue(de(ne||{})))])}))]),1032,["isAdvanced","tableAction","schema","formProps","allDefaultValues","formModel"]))),128)),Ve(ze,Ie(k.value,{onToggleAdvanced:n(P)}),Be({_:2},[fe(["resetBefore","submitBefore","advanceBefore","advanceAfter"],B=>({name:B,fn:re(H=>[ie(l.$slots,B,ue(de(H||{})))])}))]),1040,["onToggleAdvanced"]),ie(l.$slots,"formFooter")]),_:3},16)]),_:3},16,["class","model","onKeypress"]))}});export{Ot as _};
